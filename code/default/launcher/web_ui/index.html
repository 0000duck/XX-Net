<!DOCTYPE html>
<html lang="en"><!-- See http://www.w3schools.com/tags/ref_language_codes.asp -->
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <title>XX-Net</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap-responsive.css">
    <link rel="stylesheet" type="text/css" href="/css/flat-ui.css">
    <link rel="stylesheet" type="text/css" href="/css/ladda-themeless.min.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css?ver=%s">
    <!-- JavaScript -->
    <script type="text/javascript" src="/js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/flat-ui.min.js"></script>
    <script type="text/javascript" src="/js/jquery.timer.js"></script>
    <script type="text/javascript" src="/js/spin.min.js"></script>
    <script type="text/javascript" src="/js/ladda.min.js"></script>
    <script type="text/javascript" src="/js/site.js?ver=%s"></script>
    <!--[if lte IE 9]>
        <script type="text/javascript" src="/js/jquery.placeholder.min.js"></script>
        <script type="text/javascript" src="/js/jquery.xdomainrequest.min.js"></script>
    <![endif]-->
</head>
<body>
    <div id="header" class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <div class="row-fluid">
                    <div id="logo" class="span8">
                        <a href="/" title="XX-Net">
                            <img src="/img/logo.png" alt="Logo">
                            XX-Net
                        </a>
                        <a id="remote-connection-identifier" style="display: none;" href="/?module=launcher&menu=config">{{ _( "(Remote Web Control Enabled)" ) }}</a>
                    </div> <!-- #logo -->
                    <div class="span4 text-right">
                        <ul class="inline">
                            <li>
                                <a id="resize-window-trigger" href="javascript:void(0);" title='{{ _( "Adaptive width" ) }}'>
                                    <img src="/img/fixed-width.png" alt="resize-window">
                                </a>
                            </li>
                            <li>
                                <a id="quit-trigger" href="javascript:void(0);" title='{{ _( "Exit the program" ) }}'>
                                    <img src="/img/quit.png" alt="quit">
                                </a>
                            </li>
                        </ul>
                    </div> <!-- .span4 -->
                </div> <!-- .row-fluid -->
            </div> <!-- .container -->
        </div> <!-- .navbar-inner -->
    </div> <!-- #header -->
    <div id="content">
        <div class="container">
            <div class="row-fluid">
                <div id="sidebar" class="span3">
                    <div class="sidebar-nav well">
                        <ul class="nav nav-list">%s</ul>
                    </div> <!-- .sidebar-nav -->
                </div> <!-- #sidebar -->
                <div class="span9">
                    <div id="update-notify">
                        <span id="update-notify-close">×</span>
                        <span id="update-skip" class="update-notify-action">{{ _( "Do not remind me this version" ) }}</span>
                        <span id="update-next" class="update-notify-action">{{ _( "Remind me next time" ) }}</span>
                        <span id="update-now" class="update-notify-action">{{ _( "Update now" ) }}</span>
                        <span id="update-message"></span>
                    </div> <!-- #update-notify -->
                    <h2 id="title"></h2>
                    <div id="tip" class="alert fade in hide">
                        <button id="tip-close" type="button" class="close">×</button>
                        <p id="tip-message" class="message"></p>
                    </div> <!-- #tip -->
                    %s
                </div>
            </div> <!-- .row-fluid -->
        </div> <!-- .container -->
    </div> <!-- #content -->
    <!-- JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript">
        $(function() {
            window.isFullWidth = false;
        });
    </script>
    <script type="text/javascript">
        $('#resize-window-trigger').click(function() {
            isFullWidth = !isFullWidth;

            if ( isFullWidth ) {
                $('img', this).attr('src', '/img/full-width.png');
                $('.container').addClass('container-fluid');
                $('.container').removeClass('container');
            } else {
                $('img', this).attr('src', '/img/fixed-width.png');
                $('.container-fluid').addClass('container');
                $('.container-fluid').removeClass('container-fluid');
            }
        });
    </script>
    <script type="text/javascript">
        $('#quit-trigger').click(function() {
            $.ajax({
                type: 'GET',
                url: '/quit',
                dataType: 'JSON',
                success: function(result) {
                    if ( result['status'] == 'success' ) {
                        tip('{{ _( "Exited successfully" ) }}', 'success');
                    } else {
                        tip('{{ _( "Exitting failed" ) }}', 'error');
                    }
                },
                error: function() {
                    tip('{{ _( "Exitting failed. A network error occurred." ) }}', 'error');
                }
            });
        });
    </script>
    <script type="text/javascript">
        var pageRequests = {
            'cmd': 'get_config'
        };

        $.ajax({
            type: 'GET',
            url: '/config',
            data: pageRequests,
            dataType: 'JSON',
            success: function(result) {
                if ( result['allow_remote_connect'] != 0 ) {
                    $('#remote-connection-identifier').show();
                }
            }
        });
    </script>
    <script type="text/javascript">
        var checkUpdateTimeout = 600000;
        var checkUpdateTimer;
        var isShown;
        var version;
        var poptip;

        function displayErrorMessage() {
            tip('{{ _( "Unkown error occured. Please refresh the page and try again" ) }}', 'error');
        }

        function clearNotify() {
            $('#update-notify').css('display', 'none');
            isShown = null;
        }

        function startUpdateCheck() {
            var pageRequests = {};
            pageRequests['cmd'] = 'start_check';
            check_update = $('#check-update').val();
            if ( !check_update ) {
                check_update = '';
            }
            pageRequests['check_update'] = check_update;

            $.ajax({
                type: 'GET',
                url: '/update',
                data: pageRequests,
                dataType: 'JSON',
                success: function(result) {
                    if ( result['res'] == 'success' ) {
                        getUpdateInfo();
                        checkUpdateTimer.play();
                    } else {
                        tip( result['reason'], "warning");
                    }
                },
                error: function() {
                    displayErrorMessage();
                }
            });
        }

        function stopUpdateCheck() {
            clearNotify();
            checkUpdateTimer.stop();
            var pageRequests = {};
            pageRequests['cmd'] = 'set_info';
            pageRequests['info'] = 'dont-check';

            $.ajax({
                type: 'GET',
                url: '/update',
                data: pageRequests,
                dataType: 'JSON',
                success: function(result) {
                    if ( result['res'] != 'success' ) {
                        tip( result['reason'], "warning");
                    }
                },
                error: function() {
                    displayErrorMessage();
                }
            });
        }

        function clearUpdateInfo() {
            clearNotify();
            var pageRequests = {};
            pageRequests['cmd'] = 'set_info';
            pageRequests['info'] = '';

            $.ajax({
                type: 'GET',
                url: '/update',
                data: pageRequests,
                dataType: 'JSON',
                success: function(result) {
                    if ( result['res'] != 'success' ) {
                        tip( result['reason'], "warning");
                    }
                },
                error: function() {
                    displayErrorMessage();
                }
            });
        }

        function skipUpdateVersion() {
            clearNotify();
            checkUpdateTimer.stop();
            var pageRequests = {};
            pageRequests['cmd'] = 'set_config';
            pageRequests['skip_version'] = version;

            $.ajax({
                type: 'GET',
                url: '/config',
                data: pageRequests,
                dataType: 'JSON',
                success: function(result) {
                    if ( result['res'] != 'success' ) {
                        tip( result['reason'], "warning");
                    }
                },
                error: function() {
                    displayErrorMessage();
                }
            });
        }

        function updateVersion() {
            clearNotify();
            var pageRequests = {};
            pageRequests['cmd'] = 'update_version';
            pageRequests['version'] = version;
            version = null;

            $.ajax({
                type: 'GET',
                url: '/update',
                data: pageRequests,
                dataType: 'JSON',
                success: function(result) {
                    if ( result['res'] == 'success' ) {
                        tip( '{{ _( "Updating in progress ..." ) }}', "info");
                    } else {
                        tip( result['reason'], "warning");
                    }
                },
                error: function() {
                    displayErrorMessage();
                }
            });
        }

        function getUpdateInfo() {
            if (isShown) {
                return;
            }

            var pageRequests = {};
            pageRequests['cmd'] = 'get_info';

            $.ajax({
                type: 'GET',
                url: '/update',
                data: pageRequests,
                dataType: 'JSON',
                success: function(result) {
                    var versionType = result['type'];
                    switch ( versionType ) {
                    case 'init':
                        window.setTimeout(startUpdateCheck, 1000);
                        break;
                    case 'dont-check':
                        stopUpdateCheck();
                        break;
                    default:
                        version = result['version'];
                        if ( versionType && version ) {
                            switch ( versionType ) {
                            case 'stable':
                                popText = '{{ _( "Stable version" ) }} ' + version + ' {{ _( "is valid." ) }}';
                                break;
                            case 'test':
                                popText = '{{ _( "Test version" ) }} ' + version + ' {{ _( "is valid." ) }}';
                            }
                            $('#update-message').text(popText);
                            $('#update-notify').css('display', '');
                            isShown = true;
                        }
                    }
                }
            });
        }

        $('#update-now').click(updateVersion);
        $('#update-next').click(clearUpdateInfo);
        $('#update-skip').click(skipUpdateVersion);
        $('#update-notify-close').click(clearUpdateInfo);
        clearNotify();
        getUpdateInfo();
        checkUpdateTimer = $.timer(getUpdateInfo, checkUpdateTimeout, true);
    </script>
    <script type="text/javascript">
        //pop up notify on top of status web page.
        function popup_notify(text,linkText,linkHref,open_in_newtab,bcolor)
        {
            var notify_area = document.getElementById("notify-area");
            
            //create new div for notify
            var newdiv = notify_area.appendChild(document.createElement("div"));
            newdiv.className = "popnotify";
            if(bcolor != "")
            {
                newdiv.style.backgroundColor=bcolor;
            }
            
            //in new div create span as notify text
            var notify_text_span = newdiv.appendChild(document.createElement("span"));
            //write the notify text in
            notify_text_span.appendChild(document.createTextNode(text));
            notify_text_span.className = "popnotify-text";
            
            //in new div create span as link
            var notify_link_span = newdiv.appendChild(document.createElement("span"));
            notify_link_span.className = "popnotify-text";
            //in link span create link
            var notify_link = notify_link_span.appendChild(document.createElement("a"));
            if(linkHref)
            {
                //write link address in
                notify_link.href = linkHref;
            }
            else
                notify_link.href = "#"; //go nowhere
            if(open_in_newtab)
            {
                notify_link.target = "_blank";
            }
            //write link text in
            notify_link.appendChild(document.createTextNode(linkText));
            
            //create close notify button
            var notify_close_btn = newdiv.appendChild(document.createElement("span"));
            notify_close_btn.className = "popnotify-close-btn";
            notify_close_btn.appendChild(document.createTextNode("×"));
            notify_close_btn.style = "float:right; cursor: pointer;";
            notify_close_btn.onclick = function()
            {
                //close this popup
                notify_area.removeChild(this.parentNode);
            }
            //return the link object , can be used as button
            return notify_link_span;
        }
        //Examples .  uncomment to see .
        /*
        var aaa = popup_notify("This is notify example. ","click text");
        aaa.onclick = function() { alert('hello'); } 
        popup_notify("This is notify example 2 . ", "","","", "yellow");
        popup_notify("This is notify example 3 . ","Link text","whereDoWeGo",1,"#dddddd");
        */
    </script>
</body>
</html>
